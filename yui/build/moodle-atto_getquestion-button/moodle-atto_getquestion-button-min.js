YUI.add("moodle-atto_getquestion-button",function(e,t){var n="atto_getquestion",r="getquestion_flavor",i="atto_getquestion",s={INPUTSUBMIT:"atto_media_urlentrysubmit",INPUTCANCEL:"atto_media_urlentrycancel",FLAVORCONTROL:"flavorcontrol"},o={FLAVORCONTROL:".flavorcontrol"},u='<form class="atto_form"><div id="{{elementid}}_{{innerform}}" class="mdl-align"><label for="{{elementid}}_{{FLAVORCONTROL}}">{{get_string "enterflavor" component}}</label><input style="display:block; " class="{{CSS.FLAVORCONTROL}}" id="{{elementid}}_{{FLAVORCONTROL}}" name="{{elementid}}_{{FLAVORCONTROL}}" value="{{defaultflavor}}" /><button class="{{CSS.INPUTSUBMIT}}">{{get_string "insert" component}}</button><select id="questionSelect"></select><table id="questionTable" class="table table-bordered"></table></div>icon: {{clickedicon}}</form>';e.namespace("M.atto_getquestion").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){if(this.get("disabled"))return;var t=["iconone","icontwo"];e.Array.each(t,function(e){this.addButton({icon:"ed/"+e,iconComponent:"atto_getquestion",buttonName:e,callback:this._displayDialogue,callbackArgs:e})},this)},_getFlavorControlName:function(){return this.get("host").get("elementid")+"_"+r},_displayDialogue:function(t,r){t.preventDefault();var i=400,s=this.getDialogue({headerContent:M.util.get_string("dialogtitle",n),width:i+"px",focusAfterHide:r});s.width!==i+"px"&&s.set("width",i+"px");var o=this._getFormContent(r),u=e.Node.create("<div>bar</div>");u.append(o),s.set("bodyContent",u),s.show(),this.markUpdated()},_getFormContent:function(t){if(t==="iconone"){var i=e.Handlebars.compile(u),o=e.Node.create(i({elementid:this.get("host").get("elementid"),CSS:s,FLAVORCONTROL:r,component:n,defaultflavor:this.get("defaultflavor"),clickedicon:t})),a=window.location.href.split(/\=|\&|\?/),f=a[0].split(/\//)[2],l="/mod/quiz/questionbank.ajax.php",c=a[2],h="&recurse=0&showhidden=0",p="http://"+f+l+"?cmid="+c+h;console.log("start: "+p);var d=$.ajax({url:p,context:document.body}).done(function(){var e=d.responseJSON.contents;$("#questionSelect").append($("#id_selectacategory",e).children()),$("#categoryquestions",e).find("tbody label").each(function(){$("#questionTable").append("<tr><td><label><input type='radio' name='questions' value='"+$(this).attr("for").replace("checkq","")+"'/>"+"</td><td>"+$(this).children("span.questionname").text()+"</label>"+"</td></tr>")}),$("#questionSelect").change(function(){var e="";$("select optgroup option:selected").each(function(){e="http://"+f+l+"?cmid="+c+"&category="+$(this).attr("value")+h;var t=$.ajax({url:e}).done(function(){var e=t.responseJSON.contents;$("#questionTable").children().remove(),$("#categoryquestions",e).find("tbody label").each(function(){$("#questionTable").append("<tr><td><label><input type='radio' name='questions' value='"+$(this).attr("for").replace("checkq","")+"'/>"+"</td><td>"+$(this).children("span.questionname").text()+"</label>"+"</td></tr>")}),$("#questionTable tbody tr").on("click",function(){var e='{GENERICO:type="insert_question",questionid="'+$(this).find("input").attr("value")+'"}';$("#id_content_editor_getquestion_flavor").attr("value",e)})}).fail(function(){console.log("error second ajax call")}).always(function(){console.log("complete second ajax call")});$("#id_content_editor_getquestion_flavor").attr("value",e),$("#id_content_editor_").find("label").on("click",function(){var e='{GENERICO:type="insert_question",questionid="'+$(this).children("input").attr("value")+'"}';$("#id_content_editor_getquestion_flavor").attr("value",e);var t="http://"+f+l+"?cmid="+c+"&category="+e+h;console.log("change2: "+t)})})})}).fail(function(){console.log("error")}).always(function(){console.log("complete")});return this._form=o,this._form.one("."+s.INPUTSUBMIT).on("click",this._doInsert,this),o}if(t==="icontwo"){var v=e.Handlebars.compile(u),m=e.Node.create(v({elementid:this.get("host").get("elementid"),CSS:s,FLAVORCONTROL:r,component:n,defaultflavor:this.get("defaultflavor"),clickedicon:t}));this._form=m,this._form.one("."+s.INPUTSUBMIT).on("click",this._doInsert,this);var g=$("#id_content_editor_",m._node);return g.ready(function(){g.find("select").append('<optgroup required="true" label="optgroup_label"><option value="a" label="a_label">a_text</option><option value="b" label="b_label" selected="yes">a_text</option></optgroup>'),initVal=g.find('option[selected = "yes"]').attr("value"),console.log(g),g.children("input").attr("value",initVal),g.find("select").on("click",function(){console.log(this);var e='{GENERICO:type="insert_question",questionid="'+$(this).find("option").attr("value")+'"}';alert("qid: "+e),$("#id_content_editor_getquestion_flavor").attr("value",e)})}),m}},_doInsert:function(e){e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide();var t=this._form.one(o.FLAVORCONTROL);if(!t.get("value"))return;this.editor.focus(),this.get("host").insertContentAtFocusPoint(t.get("value")),this.markUpdated()}},{ATTRS:{disabled:{value:!1},usercontextid:{value:null},defaultflavor:{value:""}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
